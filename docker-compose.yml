services:
  clickhouse-server:
    image: clickhouse/clickhouse-server:24.3.6
    container_name: clickhouse-server
    ports:
      - "8124:8123"  # HTTP interface
      - "9000:9000"
    volumes:
#      - ./clickhouse/processed_configs/config.xml:/etc/clickhouse-server/config.xml
#      - ./clickhouse/processed_configs/users.xml:/etc/clickhouse-server/users.xml
      - insurance_clickhouse_volume:/var/lib/clickhouse
    restart: always

  schedule:
    image: insurance:latest
    container_name: insurance_schedule
    command: bash -c "
      printenv > /etc/environment; 
      crontab /etc/cron.monthly/crontab;
      cron -f && tail -f /var/log/cron.log"
    restart: no
    env_file:
      - .venv/.env
    volumes:
      - insurance_volume:/data
    depends_on:
      - clickhouse-server

  ch-ui:
    image: ghcr.io/caioricciuti/ch-ui:latest
    restart: always
    ports:
      - "5522:5521"
    env_file:
      - .venv/.env
    depends_on:
      - clickhouse-server

volumes:
  insurance_volume:
    driver: local
  insurance_clickhouse_volume:
    driver: local
